<%- include('../layout', { title: 'Manage Tournaments' }) %>
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>XT ESPORTS — Manage Tournaments</h2>
  <a class="btn btn-secondary" href="/admin">Back</a>
</div>

<div class="card p-3 mb-4 shadow-sm">
  <div class="d-flex align-items-center">
    <% if (settings && settings.site_banner) { %>
      <img src="<%= settings.site_banner %>" style="height:80px; object-fit:contain; margin-right:16px;">
    <% } %>
    <div>
      <h4 class="mb-0">XT ESPORTS Admin</h4>
      <small class="text-muted">Create tournaments and manage payments</small>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-6">
    <div class="card p-3 mb-4">
      <h5>Create Tournament</h5>
      <form method="post" action="/admin/tournaments" enctype="multipart/form-data">
        <div class="row">
          <div class="col-md-7 mb-3">
            <input name="name" class="form-control" placeholder="Name" required>
          </div>
          <div class="col-md-5 mb-3">
            <select name="game" class="form-control">
              <option>BGMI</option>
              <option>Free Fire</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <input name="entry_fee" class="form-control" placeholder="Entry fee (in cents)" required>
          </div>
          <div class="col-md-6 mb-3">
            <input name="max_teams" class="form-control" placeholder="Max teams">
          </div>
        </div>
        <div class="mb-3">
          <textarea name="details" class="form-control" placeholder="Details"></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Banner (image)</label>
          <input name="banner" type="file" class="form-control">
        </div>
        <button class="btn btn-success">Create</button>
      </form>
    </div>

    <h5>Existing</h5>
    <div class="row">
      <% tournaments.forEach(t => { %>
        <div class="col-md-12 mb-3">
          <div class="card p-2 d-flex flex-row align-items-center">
            <% if (t.banner) { %>
              <img src="<%= t.banner %>" style="width:120px; height:80px; object-fit:cover; margin-right:12px;">
            <% } %>
            <div>
              <h6 class="mb-0"><%= t.name %></h6>
              <p class="mb-0 text-muted"><strong>Game:</strong> <%= t.game %> • <strong>Entry:</strong> $<%= (t.entry_fee/100).toFixed(2) %></p>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card p-3 mb-4">
      <h5>Payment Settings</h5>
      <form method="post" action="/admin/settings" enctype="multipart/form-data">
        <div class="mb-3">
          <label class="form-label">UPI ID</label>
          <input name="upi" class="form-control" placeholder="8504092514@fam" value="<%= settings && settings.upi ? settings.upi : '' %>">
        </div>
        <div class="mb-3">
          <label class="form-label">Upload QR (scanner)</label>
          <input name="payment_qr" type="file" class="form-control">
          <% if (settings && settings.payment_qr) { %>
            <img src="<%= settings.payment_qr %>" style="height:120px; margin-top:10px; object-fit:contain;">
          <% } %>
        </div>
        <div class="mb-3">
          <label class="form-label">Upload Site Banner (xtesports.jpg)</label>
          <input name="site_banner" type="file" class="form-control">
        </div>
        <button class="btn btn-primary">Save Settings</button>
      </form>
    </div>

    <div class="card p-3">
      <h5>Quick Actions</h5>
      <a class="btn btn-outline-primary mb-2" href="/admin/participants">View Registrations</a>
    </div>
  </div>
</div>
